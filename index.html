<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Classifier – Linus</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --primary: #6366f1;
            --text: #f8fafc;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: var(--card);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 500px;
        }
        h1 { font-size: 1.5rem; text-align: center; color: var(--primary); margin-bottom: 1.5rem; }
        textarea {
            width: 100%;
            height: 100px;
            background: #334155;
            border: 2px solid #475569;
            border-radius: 0.5rem;
            padding: 1rem;
            color: white;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
        }
        button {
            width: 100%;
            margin-top: 1rem;
            padding: 0.8rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        #status { font-size: 0.8rem; text-align: center; margin-top: 10px; color: #94a3b8; }
        #results { margin-top: 2rem; display: none; background: #334155; padding: 1rem; border-radius: 0.5rem; }
        .token-tag { display: inline-block; background: #475569; padding: 2px 8px; border-radius: 4px; margin: 2px; font-size: 0.75rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>AI Spam & Sentiment</h1>
    <div id="status">Laddar AI-modell...</div>
    <textarea id="textInput" placeholder="Skriv din text här..."></textarea>
    <button id="predictBtn" onclick="predict()" disabled>Analysera</button>

    <div id="results">
        <div style="font-size: 1.2rem; margin-bottom: 10px;">
            <strong>Resultat:</strong> <span id="labelResult">-</span>
        </div>
        <div id="tokenOutput"></div>
    </div>
</div>

<script>
    let model, wordIndex;
    const MAX_LEN = 20;

    async function loadResources() {
        const status = document.getElementById('status');
        const btn = document.getElementById('predictBtn');
        try {
            model = await tf.loadLayersModel('tfjs_model/model.json');
            const meta = await fetch('tfjs_model/metadata.json').then(r => r.json());
            wordIndex = meta.word_index;
            status.innerText = "✅ Systemet är redo";
            btn.disabled = false;
        } catch (e) {
            status.innerText = "❌ Fel: Kunde inte ladda filerna";
            console.error(e);
        }
    }

    function tokenize(text) {
        const words = text.toLowerCase().replace(/[^\w\s]/g, "").split(/\s+/).filter(w => w.length > 0);
        const tokens = words.map(w => wordIndex[w] || 1);
        const padded = new Array(MAX_LEN).fill(0);
        for (let i = 0; i < Math.min(tokens.length, MAX_LEN); i++) padded[i] = tokens[i];
        return { words, tokens: padded };
    }

    async function predict() {
        const input = document.getElementById('textInput').value;
        if (!input) return;

        const { words, tokens } = tokenize(input);
        const tensor = tf.tensor2d([tokens], [1, MAX_LEN]);
        const prediction = await model.predict(tensor).data();
        
        // Hittar klassen med högst sannolikhet (din modell har 3 outputs)
        const labels = ["Negativ/Spam", "Neutral", "Positiv/Ham"];
        const maxIdx = prediction.indexOf(Math.max(...prediction));

        document.getElementById('results').style.display = 'block';
        document.getElementById('labelResult').innerText = labels[maxIdx] + " (" + (prediction[maxIdx]*100).toFixed(1) + "%)";
        document.getElementById('tokenOutput').innerHTML = words.map((w, i) => 
            `<span class="token-tag">${w} (${tokens[i]})</span>`).join('');
        
        tf.dispose(tensor);
    }

    loadResources();
</script>

</body>
</html>
